#!/bin/bash

binDir=/app/bin
buildDir=$1;
cacheDir=$2;

if [ ! -s $1/.binurls ]; then
  echo "-----> Skipping empty .binurls file"
  exit 0
fi

mkdir -p $binDir
cd $cacheDir

read_url() {
  url=$1;
  echo "-----> Reading \"$url\""

  file=$(basename $url)
  file=${file%%.*}

  if [ -f $cacheDir/$file ]; then
    echo "-----> $file is cached"
  else
    echo "-----> Downloading \"$url\""
    curl -sL $url | tar xz
  fi

  echo -e "-----> Copying $file to $binDir\n"
  cp $file $binDir
}

while read url; do
  if [ -n "$url" ]; then
    read_url $url
  fi
done < $buildDir/.binurls
